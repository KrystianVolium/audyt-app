<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://api.fontshare.com; font-src 'self' https://api.fontshare.com https://cdn.fontshare.com; img-src 'self' data:; connect-src 'self' http://localhost:3000 https://*.netlify.app https://audyt-backend.onrender.com;">
    <title>Audyt Kondycji Marki | Wersja Finalna</title>
 
    <link href="https://api.fontshare.com/v2/css?f[]=satoshi@700,500,400&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
 
    <style>
        :root {
            --bg-color: #FFFFFF;
            --surface-color: rgba(255, 255, 255, 0.7);
            --primary-color: #707070;
            --primary-glow: rgba(112, 112, 112, 0.3);
            --text-color: #2C2C2C;
            --text-muted: #707070;
            --border-color: rgba(44, 44, 44, 0.15);
            --glow-critical: #ff4d4d;
            --glow-reactive: #ffa500;
            --glow-proactive: #00aaff;
            --glow-strategic: #707070;
        }
 
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
 
        body {
            font-family: 'Satoshi', sans-serif;
            background-color: #FFFFFF;
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            font-weight: 400;
        }

        .audit-container {
            width: 100%;
            max-width: 804px;
            background: transparent;
            border: none;
            border-radius: 0;
            padding: 0;
            box-shadow: none;
        }
 
        h1, h2, h3 {
            font-weight: 700; letter-spacing: -0.05em; line-height: 1.1;
            text-align: center; color: var(--text-color);
        }
        h1 { font-size: 2.5em; margin-bottom: 10px; }
        h2 { font-size: 2em; margin-bottom: 25px; margin-top: 10px; }
        h3 { font-size: 1.5em; }
 
        h3.pytanie-lustro-tytul {
            text-align: left; margin-top: 40px; margin-bottom: 15px;
        }
 
        p {
            font-size: 1em;
            line-height: 1.1;
            color: var(--text-muted);
            margin-bottom: 15px;
            font-weight: 400;
        }
        .question-block p, .result-card p, #ai-synthesis-container p {
            color: var(--text-color);
            line-height: 1.1;
        }
        .result-card p, #ai-synthesis-container p {
            color: var(--text-muted);
            line-height: 1.1;
        }

        strong {
            color: var(--text-color);
            font-weight: 700;
        }
        .intro-subtext {
            text-align: center;
            font-size: 1.1em;
            color: var(--text-muted);
            line-height: 1.1;
        }
 
        #logo-container { text-align: center; margin: 0 0 30px 0; }
        #logo-container img, #logo-container svg {
            max-width: 160px;
            height: auto;
            filter: brightness(0) saturate(100%) invert(47%) sepia(0%) saturate(0%) hue-rotate(204deg) brightness(94%) contrast(86%);
        }
 
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: var(--border-color);
            border-radius: 5px;
            margin-bottom: 40px;
            overflow: hidden;
            transition: opacity 0.3s ease-in-out, height 0.3s, margin 0.3s;
        }
        .progress-fill {
            width: 0%; height: 100%; background-color: var(--primary-color);
            border-radius: 5px; transition: width 0.4s ease-in-out;
        }
 
        /* Ukryj progress bar i stopkę na pierwszych dwóch ekranach */
        .on-first-step .progress-bar {
            display: none !important;
        }

        .on-results-step .progress-bar {
            display: none !important;
        }

        .signature-footer {
            text-align: center;
            width: 100%;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid var(--border-color);
        }

        .signature-footer p {
            font-size: 0.8em;
            color: var(--text-muted);
            margin-bottom: 15px;
            line-height: 1.1;
        }

        .signature-footer img {
            width: 100px;
            height: auto;
            opacity: 0.7;
            filter: brightness(0) saturate(100%) invert(47%) sepia(0%) saturate(0%) hue-rotate(204deg) brightness(94%) contrast(86%);
        }

        .on-first-step .signature-footer {
            display: none !important;
        }

        .on-results-step .signature-footer {
            display: none !important;
        }
 
        #audit-form { position: relative; }

        .form-content-wrapper {
            width: 804px;
            margin: 40px auto;
            background: transparent;
            border: none;
            padding: 0;
            position: relative;
            min-height: 400px;
            pointer-events: auto;
        }

        /* Box styling dla WSZYSTKICH ekranów */
        .screen {
            display: none;
            animation: fadeIn 0.5s forwards;
            flex-direction: column;
            align-items: center;
            width: 100%;
            background: rgba(216, 216, 216, 0.17);
            border: 2px solid rgba(44, 44, 44, 0.15);
            border-radius: 24px;
            padding: 60px 80px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            filter: url(#grainNoise);
        }
        .screen.active {
            display: flex;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
 
        .question-block {
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            border: 1px solid rgba(44, 44, 44, 0.1);
            transition: border-color 0.3s;
        }
 
        .scale-container {
            display: flex; justify-content: space-around; align-items: flex-start;
            margin-top: 15px; text-align: center;
        }
        .scale-item {
            display: flex; flex-direction: column; align-items: center; width: 20%;
        }
        .scale-container input[type="radio"] { display: none; }
        .scale-container label {
            display: flex; justify-content: center; align-items: center; width: 45px; height: 45px;
            border: 2px solid var(--border-color); border-radius: 50%; cursor: pointer;
            font-weight: 700; font-size: 1.2em; transition: all 0.3s ease; color: var(--text-muted);
            margin-bottom: 8px;
        }
        .scale-container .scale-description {
            min-height: 40px; font-weight: 500; line-height: 1.3;
            font-size: 0.75em; color: var(--text-muted); padding: 0 2px;
        }
        .scale-container label:hover { border-color: var(--text-muted); color: var(--text-color); }
        .scale-container input[type="radio"]:checked + label {
            background-color: var(--primary-color); color: #FFFFFF;
            border-color: var(--primary-color); transform: scale(1.1);
            box-shadow: 0 0 15px var(--primary-glow);
        }
 
        textarea {
            width: 100%; min-height: 120px; padding: 15px; font-family: 'Satoshi', sans-serif;
            font-size: 1em; border: 1px solid var(--border-color); border-radius: 8px;
            background-color: var(--bg-color); color: var(--text-color); margin-top: 10px;
            transition: border-color 0.3s, box-shadow 0.3s;
            font-weight: 400;
        }
        textarea:focus, input[type="text"]:focus {
            outline: none; border-color: var(--primary-color); box-shadow: 0 0 10px var(--primary-glow);
        }
 
        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            width: 100%;
            gap: 20px;
        }
        .btn {
            padding: 12px 30px; border: none; border-radius: 50px; font-family: 'Satoshi', sans-serif;
            font-weight: 700; font-size: 1em; cursor: pointer; transition: all 0.3s ease;
            background: var(--surface-color); color: var(--text-color); border: 1px solid var(--border-color);
            text-transform: uppercase;
            text-decoration: none;
        }
        .btn:hover { border-color: var(--text-color); }
        .btn-primary {
            background: var(--primary-color); color: #FFFFFF; border: 1px solid var(--primary-color);
        }
        .btn-primary:hover {
            box-shadow: 0 0 20px var(--primary-glow); transform: translateY(-2px);
        }
 
        #screen-results { text-align: center; }
 
        #capture-area { padding: 1px; } 
        #logo-container-results { text-align: center; margin-bottom: 40px; }
        #logo-container-results img, #logo-container-results svg { max-width: 160px; height: auto; }
        #score-container { font-size: 3em; font-weight: 700; line-height: 1.1; }
        #score-display { color: var(--primary-color); font-size: 2em; }
 
        .result-card {
            background: var(--surface-color); padding: 30px; border-radius: 12px;
            border: 1px solid var(--border-color); margin-top: 20px;
            transition: all 0.5s ease-in-out;
        }
        #ai-synthesis-container {
             background: var(--surface-color); padding: 30px; border-radius: 12px;
            border: 1px solid var(--border-color); margin-top: 20px;
        }
 
        .result-card.glow-critical { border-color: var(--glow-critical); box-shadow: 0 0 25px rgba(255, 77, 77, 0.3); }
        .result-card.glow-reactive { border-color: var(--glow-reactive); box-shadow: 0 0 25px rgba(255, 165, 0, 0.3); }
        .result-card.glow-proactive { border-color: var(--glow-proactive); box-shadow: 0 0 25px rgba(0, 170, 255, 0.3); }
        .result-card.glow-strategic { border-color: var(--glow-strategic); box-shadow: 0 0 25px rgba(112, 112, 112, 0.3); }
 
        .result-card h3, #ai-synthesis-container h3, #next-steps-gibberish h3, #next-steps-content h3 {
            color: var(--text-color); margin-bottom: 15px;
        }
 
        #ai-loader { display: none; margin-top: 20px; }
        @keyframes pulse {
            0% { opacity: 0.6; transform: translateY(0px); }
            50% { opacity: 1; transform: translateY(-2px); }
            100% { opacity: 0.6; transform: translateY(0px); }
        }
        #ai-loader p { animation: pulse 2s infinite; color: var(--text-muted); text-align: center; font-weight: 600;}
 
        #final-cta-btn { display: inline-block; }
        #download-btn { margin: 25px auto; display: none; }
        #next-steps { margin-top: 40px; }
        #next-steps h3 { margin-bottom: 15px; }
 
 
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-10px); }
        }

        .fade-out {
            animation: fadeOut 0.4s ease-out forwards;
        }

        @media (max-width: 768px) {
            .audit-container { padding: 20px; }
            .form-content-wrapper {
                width: 100%;
                max-width: 400px;
                padding: 40px 20px;
                min-height: 300px;
            }
            .screen {
                width: 100%;
            }
            h1 { font-size: 2em; }
            h2 { font-size: 1.5em; }
            .intro-subtext { line-height: 1.1; }
            .btn { padding: 10px 20px; font-size: 0.85em; }
            .scale-container label { width: 40px; height: 40px; font-size: 1.1em; }
        }

        /* === JASNY INTERFEJS - KOMPLETNY REDESIGN === */
        #screen-segment {
            justify-content: flex-start;
            position: relative;
            z-index: 10;
        }

        .start-logo {
            margin-bottom: 50px;
            text-align: center;
            position: relative;
            z-index: 20;
        }

        .start-logo img {
            height: 48px;
            width: auto;
            display: block;
            margin: 0 auto;
            filter: brightness(0) saturate(100%) invert(47%) sepia(0%) saturate(0%) hue-rotate(204deg) brightness(94%) contrast(86%);
        }

        .start-title {
            font-family: 'Satoshi', sans-serif;
            font-weight: 700;
            font-size: 56px;
            color: #2C2C2C;
            letter-spacing: -0.05em;
            margin: 0 0 16px 0;
            text-align: center;
            line-height: 1.1;
            position: relative;
            z-index: 20;
        }

        .start-subtitle {
            font-family: 'Satoshi', sans-serif;
            font-weight: 400;
            font-size: 18px;
            color: #2C2C2C;
            max-width: 600px;
            text-align: center;
            margin: 0 auto 70px;
            line-height: 1.1;
            position: relative;
            z-index: 20;
        }

        .segment-question {
            font-family: 'Satoshi', sans-serif;
            font-weight: 500;
            font-size: 32px;
            color: #2C2C2C;
            text-align: center;
            margin-bottom: 36px;
            line-height: 1.1;
            letter-spacing: -0.05em;
            position: relative;
            z-index: 20;
        }

        .segment-choice-container {
            display: flex;
            gap: 24px;
            justify-content: center;
            align-items: stretch;
            margin-bottom: 50px;
            flex-wrap: nowrap;
            position: relative;
            z-index: 50;
            pointer-events: auto;
        }

        .segment-card {
            width: 266px;
            height: auto;
            min-height: 180px;
            background: rgba(44, 44, 44, 0.04);
            border: 2px solid rgba(44, 44, 44, 0.08);
            border-radius: 12px;
            padding: 28px 24px;
            box-shadow: 4px 4px 5px 0px rgba(0, 0, 0, 0.25);
            cursor: pointer !important;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            text-align: center;
            position: relative;
            filter: brightness(1) contrast(1.02);
            overflow: hidden;
            word-wrap: break-word;
            z-index: 100;
            pointer-events: auto !important;
        }

        .segment-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 1px,
                rgba(0, 0, 0, 0.03) 1px,
                rgba(0, 0, 0, 0.03) 2px
            );
            pointer-events: none !important;
            border-radius: 12px;
            z-index: 1;
        }

        .segment-card:hover {
            background: rgba(44, 44, 44, 0.12);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(44, 44, 44, 0.15);
            border: 2px solid rgba(44, 44, 44, 0.2);
        }

        .segment-card.selected {
            background: rgba(112, 112, 112, 0.08);
            border: 2px solid rgba(112, 112, 112, 0.4);
            box-shadow: 0 0 0 3px rgba(112, 112, 112, 0.1);
        }

        .segment-icon {
            width: 48px;
            height: 48px;
            margin-bottom: 20px;
        }

        .segment-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: brightness(0) saturate(100%) invert(47%) sepia(0%) saturate(0%) hue-rotate(204deg) brightness(94%) contrast(86%);
        }

        .segment-card h3 {
            font-family: 'Satoshi', sans-serif;
            font-weight: 500;
            font-size: 16px;
            color: #2C2C2C;
            letter-spacing: 0.02em;
            margin: 0 0 8px 0;
            text-align: center;
            text-transform: uppercase;
            word-wrap: break-word;
            width: 100%;
            line-height: 1.1;
        }

        .segment-card p {
            font-family: 'Satoshi', sans-serif;
            font-weight: 400;
            font-size: 14px;
            color: #707070;
            margin: 0;
            text-align: center;
            line-height: 1.1;
            word-wrap: break-word;
            width: 100%;
        }

        .start-cta-button {
            font-family: 'Satoshi', sans-serif;
            font-weight: 500;
            font-size: 16px;
            background: #707070;
            color: #FFFFFF;
            padding: 14px 48px;
            border-radius: 50px;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            display: block;
            margin: 0 auto;
            position: relative;
            z-index: 20;
            line-height: 1.1;
        }

        .start-cta-button:hover:not(:disabled) {
            background: #5A5A5A;
            transform: translateY(-1px);
        }

        .start-cta-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Responsive dla ekranu startowego */
        @media (max-width: 768px) {
            .start-logo {
                margin-bottom: 40px;
            }
            .start-logo img {
                height: 36px;
            }
            .start-title {
                font-size: 32px;
            }
            .start-subtitle {
                font-size: 16px;
                margin-bottom: 50px;
            }
            .segment-question {
                font-size: 24px;
                margin-bottom: 24px;
            }
            .segment-choice-container {
                flex-direction: column;
                align-items: center;
                margin-bottom: 40px;
            }
            .segment-card {
                width: 100%;
                max-width: 340px;
            }
        }

        /* === EKRAN WYNIKU PUNKTOWEGO === */
        #screen-score {
            justify-content: flex-start;
            padding: 40px 60px;
            max-width: 700px;
            margin: 0 auto;
        }

        #screen-score .start-logo {
            margin-bottom: 30px;
        }

        .progress-ring-container {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 40px auto;
        }

        .progress-ring-container svg {
            transform: rotate(0deg);
        }

        #progress-ring {
            transition: stroke-dashoffset 2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .score-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .score-display .score {
            font-family: 'Satoshi', sans-serif;
            font-weight: 700;
            font-size: 96px;
            color: #2C2C2C;
            line-height: 1;
            display: block;
        }

        .score-display .total {
            font-family: 'Satoshi', sans-serif;
            font-weight: 400;
            font-size: 32px;
            color: #707070;
            line-height: 1;
        }

        .level-name {
            font-family: 'Satoshi', sans-serif;
            font-weight: 700;
            font-size: 28px;
            color: #2C2C2C;
            text-align: center;
            margin: 32px auto 20px;
            line-height: 1.1;
        }

        .level-description {
            font-family: 'Satoshi', sans-serif;
            font-weight: 400;
            font-size: 16px;
            color: #2C2C2C;
            text-align: center;
            max-width: 600px;
            margin: 0 auto 40px;
            line-height: 1.5;
        }

        #see-full-analysis-btn {
            display: block;
            margin: 0 auto;
            padding: 14px 40px;
            background: #707070;
            color: #FFFFFF;
            border: none;
            border-radius: 50px;
            font-family: 'Satoshi', sans-serif;
            font-weight: 500;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #see-full-analysis-btn:hover {
            background: #5A5A5A;
            transform: translateY(-1px);
        }

        .score-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid var(--border-color);
            font-family: 'Satoshi', sans-serif;
            font-weight: 400;
            font-size: 12px;
            color: #707070;
        }

        @media (max-width: 768px) {
            .progress-ring-container {
                width: 220px;
                height: 220px;
                margin: 30px auto;
            }

            .progress-ring-container svg {
                width: 220px;
                height: 220px;
            }

            .score-display .score {
                font-size: 72px;
            }

            .score-display .total {
                font-size: 24px;
            }

            .level-name {
                font-size: 22px;
                margin: 24px auto 16px;
            }

            .level-description {
                font-size: 14px;
                max-width: 90%;
            }

            .score-footer {
                flex-direction: column;
                gap: 8px;
                text-align: center;
            }
        }

        /* CTA Buttons Container */
        .cta-buttons-container {
            display: flex !important;
            flex-direction: row !important;
            gap: 15px;
            justify-content: center;
            align-items: center;
            margin-top: 25px;
            flex-wrap: nowrap !important;
        }
        .cta-buttons-container .btn {
            white-space: nowrap;
            margin: 0 !important;
        }
        @media (max-width: 768px) {
            .cta-buttons-container {
                flex-direction: column; gap: 12px;
            }
            .cta-buttons-container .btn {
                width: 100%;
            }
        }

        /* === NEW: 3-SCREEN RESULTS FLOW === */
        .result-screen {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .result-screen.active {
            opacity: 1;
        }

        /* SCREEN 1: AI Analysis - NOWY DESIGN */
        #result-screen-1 {
            padding: 0 !important;
            overflow: hidden;
        }

        .analysis-header-image {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 24px 24px 0 0;
            margin: 0;
            padding: 0;
        }

        .analysis-title {
            font-family: 'Satoshi', sans-serif;
            font-weight: 700;
            font-size: 32px;
            color: #2C2C2C;
            text-align: center;
            margin: 40px 60px 16px;
            line-height: 1.2;
        }

        .analysis-intro {
            font-family: 'Satoshi', sans-serif;
            font-weight: 400;
            font-style: italic;
            font-size: 18px;
            color: #2C2C2C;
            text-align: center;
            line-height: 1.4;
            margin: 16px 80px 40px;
            max-width: 650px;
            margin-left: auto;
            margin-right: auto;
        }

        .analysis-subtitle {
            font-family: 'Satoshi', sans-serif;
            font-weight: 400;
            font-size: 16px;
            color: #707070;
            text-align: center;
            margin: 0 60px 32px;
            line-height: 1.4;
        }

        .ai-analysis-content {
            font-family: 'Satoshi', sans-serif;
            font-weight: 400;
            font-size: 16px;
            color: #2C2C2C;
            line-height: 1.6;
            padding: 0 60px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 40px;
        }

        /* Stylowany scrollbar */
        .ai-analysis-content::-webkit-scrollbar {
            width: 8px;
        }

        .ai-analysis-content::-webkit-scrollbar-track {
            background: rgba(44, 44, 44, 0.05);
            border-radius: 4px;
        }

        .ai-analysis-content::-webkit-scrollbar-thumb {
            background: rgba(44, 44, 44, 0.2);
            border-radius: 4px;
        }

        .ai-analysis-content::-webkit-scrollbar-thumb:hover {
            background: rgba(44, 44, 44, 0.3);
        }

        #ai-loader-screen2 {
            text-align: center;
            padding: 60px 20px;
            color: #707070;
        }

        #ai-loader-screen2 p {
            animation: pulse 2s infinite;
        }

        #ai-analysis-text {
            color: #2C2C2C;
            white-space: pre-wrap;
        }

        .analysis-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            align-items: center;
            margin: 0 60px 40px;
        }

        .btn-secondary-outline {
            background: transparent;
            color: #2C2C2C;
            border: 2px solid #2C2C2C;
            padding: 14px 32px;
            font-family: 'Satoshi', sans-serif;
            font-weight: 700;
            font-size: 14px;
            letter-spacing: 0.5px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary-outline:hover {
            background: #2C2C2C;
            color: #FFFFFF;
        }

        #go-to-cta-btn {
            padding: 14px 32px;
            font-size: 14px;
            min-width: auto;
            margin: 0;
        }

        .analysis-footer {
            position: sticky;
            bottom: 0;
            background: rgba(216, 216, 216, 0.17);
            border-top: 1px solid rgba(44, 44, 44, 0.1);
            padding: 20px 60px;
            text-align: center;
        }

        .analysis-footer p {
            font-family: 'Satoshi', sans-serif;
            font-weight: 400;
            font-size: 12px;
            color: #707070;
            margin: 0;
        }

        /* SCREEN 3: CTA Hub */
        .cta-hub-title {
            text-align: center;
            font-size: 2.5em;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 50px;
        }
        .cta-hub-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            max-width: 1000px;
            margin: 0 auto 60px;
        }
        .cta-hub-card {
            background: rgba(44, 44, 44, 0.3);
            border: 2px solid #2C2C2C;
            border-radius: 16px;
            padding: 40px 30px;
            text-align: center;
            text-decoration: none;
            color: var(--text-primary);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }
        .cta-hub-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 8px 32px rgba(178, 140, 255, 0.3);
            transform: translateY(-5px);
        }
        .cta-icon {
            font-size: 3em;
            margin-bottom: 20px;
        }
        .cta-hub-card h3 {
            font-size: 1.5em;
            font-weight: 700;
            margin: 0 0 15px 0;
            color: var(--text-primary);
        }
        .cta-hub-card p {
            font-size: 1em;
            color: var(--text-muted);
            margin: 0;
            line-height: 1.6;
        }
        .social-footer {
            text-align: center;
            padding-top: 40px;
            border-top: 1px solid #2C2C2C;
            max-width: 600px;
            margin: 0 auto;
        }
        .social-footer p {
            color: var(--text-muted);
            margin-bottom: 15px;
        }
        .social-links {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        .social-links a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.95em;
            transition: color 0.3s ease;
        }
        .social-links a:hover {
            color: var(--primary-color);
        }

        /* Responsive adjustments for new screens */
        @media (max-width: 768px) {
            .author-photo {
                width: 100px;
                height: 100px;
            }
            .author-greeting {
                font-size: 1.5em;
            }
            .ai-analysis-content {
                padding: 25px;
                font-size: 1em;
            }
            .cta-hub-title {
                font-size: 1.8em;
            }
            .cta-hub-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .cta-hub-card {
                padding: 30px 20px;
            }
        }
        @media (max-width: 480px) {
            .author-greeting {
                font-size: 1.3em;
            }
            .cta-hub-title {
                font-size: 1.5em;
            }
            .cta-icon {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="audit-container">
        <form id="audit-form" autocomplete="off">
            <div class="form-content-wrapper">
                <!-- Ekran 0: Wybór segmentu - REDESIGN -->
                <div class="screen active" id="screen-segment">
                    <div class="start-logo">
                        <img src="twoje-logo.svg.svg" alt="Logo">
                    </div>

                    <h1 class="start-title">Audyt Kondycji Marki</h1>
                    <p class="start-subtitle">Narzędzie diagnostyczne dla Liderów, którzy chcą przestać zgadywać, a zacząć wygrywać.</p>

                    <h2 class="segment-question">Jaką markę budujesz?</h2>

                    <div class="segment-choice-container">
                        <div class="segment-card" data-segment="company">
                            <div class="segment-icon">
                                <img src="ph_buildings-thin.svg" alt="Firma">
                            </div>
                            <h3>Zarządzam Marką Firmy</h3>
                            <p>Zespół, organizacja, biznes B2B/B2C</p>
                        </div>
                        <div class="segment-card" data-segment="personal">
                            <div class="segment-icon">
                                <img src="icon-personal.svg" alt="Osoba">
                            </div>
                            <h3>Buduję Markę Osobistą</h3>
                            <p>Freelancer, ekspert, soloprzedsiębiorca</p>
                        </div>
                    </div>

                    <button type="button" class="start-cta-button btn-next" id="segment-next-btn" disabled>DALEJ</button>
                </div>

                <!-- Ekran 1: Personalizacja -->
                <div class="screen" id="screen-personalization">
                    <div id="logo-container">
                        <img src="twoje-logo.svg.svg" alt="Logo Firmy">
                    </div>
                    <h1>Audyt Kondycji Marki</h1>
                    <p class="intro-subtext">Narzędzie diagnostyczne dla liderów, którzy chcą przestać zgadywać i zacząć wygrywać.</p>

                    <div style="max-width: 400px; margin: 30px auto;">
                        <div style="margin-bottom: 20px;">
                            <label for="user-name" style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-color);">Twoje imię:</label>
                            <input type="text" id="user-name" placeholder="np. Anna" style="width: 100%; padding: 12px; font-family: 'Satoshi', sans-serif; font-size: 1em; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--bg-color); color: var(--text-color); transition: border-color 0.3s, box-shadow 0.3s;">
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label for="brand-name" id="brand-name-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-color);">Nazwa Twojej marki/firmy:</label>
                            <input type="text" id="brand-name" placeholder="np. ABC Marketing" style="width: 100%; padding: 12px; font-family: 'Satoshi', sans-serif; font-size: 1em; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--bg-color); color: var(--text-color); transition: border-color 0.3s, box-shadow 0.3s;">
                        </div>
                    </div>

                    <div class="form-navigation">
                        <button type="button" class="btn btn-prev">Wróć</button>
                        <button type="button" class="btn btn-primary btn-next">Zaczynam</button>
                    </div>
                </div>

                <div class="screen" id="screen-section1">
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <h2>Sekcja I: Rdzeń Strategiczny</h2>
                <!-- Q1 dla Marki Firmy -->
                <div class="question-block" data-segment="company">
                    <p><strong>1. Nasz cel istnienia (Brand Purpose) jest na tyle klarowny i wdrożony, że pracownicy na każdym szczeblu potrafią na jego podstawie samodzielnie podejmować spójne decyzje.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q1-1" name="q1" value="1"><label for="q1-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q1-2" name="q1" value="2"><label for="q1-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q1-3" name="q1" value="3"><label for="q1-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q1-4" name="q1" value="4"><label for="q1-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q1-5" name="q1" value="5"><label for="q1-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <!-- Q1 dla Marki Osobistej -->
                <div class="question-block" data-segment="personal">
                    <p><strong>1. Mój cel istnienia jako eksperta/twórcy (Personal Brand Purpose) jest na tyle klarowny, że potrafię szybko ocenić czy nowy projekt, współpraca czy klient są zgodne z moją misją.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q1p-1" name="q1" value="1"><label for="q1p-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q1p-2" name="q1" value="2"><label for="q1p-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q1p-3" name="q1" value="3"><label for="q1p-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q1p-4" name="q1" value="4"><label for="q1p-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q1p-5" name="q1" value="5"><label for="q1p-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <!-- Q2 dla Marki Firmy -->
                <div class="question-block" data-segment="company">
                     <p><strong>2. Nasza długoterminowa wizja jest tak precyzyjnym filtrem, że regularnie i bez wahania odrzucamy "dobre" okazje i projekty, które do niej nie pasują.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q2-1" name="q2" value="1"><label for="q2-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q2-2" name="q2" value="2"><label for="q2-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q2-3" name="q2" value="3"><label for="q2-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q2-4" name="q2" value="4"><label for="q2-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q2-5" name="q2" value="5"><label for="q2-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <!-- Q2 dla Marki Osobistej -->
                <div class="question-block" data-segment="personal">
                     <p><strong>2. Moja długoterminowa wizja jest tak precyzyjnym filtrem, że regularnie i bez wahania odrzucam "dobre" okazje i projekty, które do niej nie pasują.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q2p-1" name="q2" value="1"><label for="q2p-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q2p-2" name="q2" value="2"><label for="q2p-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q2p-3" name="q2" value="3"><label for="q2p-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q2p-4" name="q2" value="4"><label for="q2p-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q2p-5" name="q2" value="5"><label for="q2p-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <!-- Q3 dla Marki Firmy -->
                <div class="question-block" data-segment="company">
                    <p><strong>3. Nasze zasady marki (Brand Principles) działają jak system operacyjny dla firmy, dostarczając jasnych kryteriów dla kluczowych decyzji - od marketingu, przez sprzedaż, po rekrutację.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q3-1" name="q3" value="1"><label for="q3-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q3-2" name="q3" value="2"><label for="q3-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q3-3" name="q3" value="3"><label for="q3-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q3-4" name="q3" value="4"><label for="q3-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q3-5" name="q3" value="5"><label for="q3-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <!-- Q3 dla Marki Osobistej -->
                <div class="question-block" data-segment="personal">
                    <p><strong>3. Moje zasady marki osobistej (Brand Principles) działają jak wewnętrzny kompas – pomagają mi wybierać projekty, ustalać granice i komunikować wartości w sposób autentyczny i konsekwentny.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q3p-1" name="q3" value="1"><label for="q3p-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q3p-2" name="q3" value="2"><label for="q3p-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q3p-3" name="q3" value="3"><label for="q3p-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q3p-4" name="q3" value="4"><label for="q3p-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q3p-5" name="q3" value="5"><label for="q3p-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <h3 class="pytanie-lustro-tytul">Pytanie Lustro</h3>
                <!-- Mirror Q1 dla Marki Firmy -->
                <p data-segment="company">Gdybyś jutro zamknął firmę, za czym, oprócz produktu/usługi, najbardziej zatęskniliby Twoi klienci i pracownicy?</p>
                <!-- Mirror Q1 dla Marki Osobistej -->
                <p data-segment="personal">Gdybyś jutro zakończył swoją działalność, za czym najbardziej zatęskniłyby osoby, które cię obserwują i z tobą współpracują – oprócz samych produktów czy usług?</p>
                <textarea id="mirror-q1" placeholder="Twoja odpowiedź..."></textarea>
                <div class="form-navigation">
                    <button type="button" class="btn btn-prev">Wróć</button>
                    <button type="button" class="btn btn-primary btn-next">Dalej</button>
                </div>
                <div class="signature-footer">
                    <p>Audyt przygotowany przez:</p>
                    <img src="twoje-logo.svg.svg" alt="Logo Firmy">
                </div>
            </div>

            <div class="screen" id="screen-section2">
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <h2>Sekcja II: Pozycjonowanie Rynkowe</h2>
                 <!-- Q4 dla Marki Firmy -->
                 <div class="question-block" data-segment="company">
                    <p><strong>4. Nasi idealni klienci postrzegają naszą ofertę jako unikatną i potrafią jasno wskazać, dlaczego jesteśmy dla nich jedynym logicznym wyborem na rynku.</strong></p>
                     <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q4-1" name="q4" value="1"><label for="q4-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q4-2" name="q4" value="2"><label for="q4-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q4-3" name="q4" value="3"><label for="q4-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q4-4" name="q4" value="4"><label for="q4-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q4-5" name="q4" value="5"><label for="q4-5">5</label><span class="scale-description"></span></div>
                     </div>
                 </div>
                 <!-- Q4 dla Marki Osobistej -->
                 <div class="question-block" data-segment="personal">
                    <p><strong>4. Moi idealni klienci postrzegają moją ofertę jako unikatową i potrafią jasno wskazać, dlaczego jestem dla nich jedynym logicznym wyborem na rynku.</strong></p>
                     <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q4p-1" name="q4" value="1"><label for="q4p-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q4p-2" name="q4" value="2"><label for="q4p-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q4p-3" name="q4" value="3"><label for="q4p-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q4p-4" name="q4" value="4"><label for="q4p-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q4p-5" name="q4" value="5"><label for="q4p-5">5</label><span class="scale-description"></span></div>
                     </div>
                 </div>
                <!-- Q5 dla Marki Firmy -->
                <div class="question-block" data-segment="company">
                     <p><strong>5. Nasze rozmowy o cenie koncentrują się na zwrocie z inwestycji (ROI) i wartości biznesowej dla klienta, a nie na porównaniach z konkurencją czy liczbie roboczogodzin.</strong></p>
                     <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q5-1" name="q5" value="1"><label for="q5-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q5-2" name="q5" value="2"><label for="q5-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q5-3" name="q5" value="3"><label for="q5-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q5-4" name="q5" value="4"><label for="q5-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q5-5" name="q5" value="5"><label for="q5-5">5</label><span class="scale-description"></span></div>
                     </div>
                 </div>
                <!-- Q5 dla Marki Osobistej -->
                <div class="question-block" data-segment="personal">
                     <p><strong>5. Moje rozmowy o cenie koncentrują się na zwrocie z inwestycji (ROI) i wartości biznesowej dla klienta, a nie na porównaniach z konkurencją czy liczbie roboczogodzin.</strong></p>
                     <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q5p-1" name="q5" value="1"><label for="q5p-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q5p-2" name="q5" value="2"><label for="q5p-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q5p-3" name="q5" value="3"><label for="q5p-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q5p-4" name="q5" value="4"><label for="q5p-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q5p-5" name="q5" value="5"><label for="q5p-5">5</label><span class="scale-description"></span></div>
                     </div>
                 </div>
                <!-- Q6 dla Marki Firmy -->
                <div class="question-block" data-segment="company">
                     <p><strong>6. Dzięki precyzyjnej specjalizacji i komunikacji, przyciągamy niemal wyłącznie klientów, którzy idealnie pasują do naszego profilu i z którymi chcemy pracować.</strong></p>
                     <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q6-1" name="q6" value="1"><label for="q6-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q6-2" name="q6" value="2"><label for="q6-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q6-3" name="q6" value="3"><label for="q6-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q6-4" name="q6" value="4"><label for="q6-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q6-5" name="q6" value="5"><label for="q6-5">5</label><span class="scale-description"></span></div>
                     </div>
                 </div>
                <!-- Q6 dla Marki Osobistej -->
                <div class="question-block" data-segment="personal">
                     <p><strong>6. Dzięki precyzyjnej specjalizacji i komunikacji, przyciągam niemal wyłącznie klientów, którzy idealnie pasują do mojego profilu i z którymi chcę pracować.</strong></p>
                     <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q6p-1" name="q6" value="1"><label for="q6p-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q6p-2" name="q6" value="2"><label for="q6p-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q6p-3" name="q6" value="3"><label for="q6p-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q6p-4" name="q6" value="4"><label for="q6p-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q6p-5" name="q6" value="5"><label for="q6p-5">5</label><span class="scale-description"></span></div>
                     </div>
                 </div>
                <h3 class="pytanie-lustro-tytul">Pytanie Lustro</h3>
                <!-- Mirror Q2 dla Marki Firmy -->
                <p data-segment="company">Jaki jest największy, niewykorzystany potencjał w Twojej firmie, który mógłby zrewolucjonizować Twoją pozycję na rynku?</p>
                <!-- Mirror Q2 dla Marki Osobistej -->
                <p data-segment="personal">Jaki jest największy, niewykorzystany potencjał w Twojej osobistej marce eksperckiej, który mógłby zrewolucjonizować Twoją pozycję na rynku?</p>
                <textarea id="mirror-q2" placeholder="Twoja odpowiedź..."></textarea>
                <div class="form-navigation">
                    <button type="button" class="btn btn-prev">Wróć</button>
                    <button type="button" class="btn btn-primary btn-next">Dalej</button>
                </div>
                <div class="signature-footer">
                    <p>Audyt przygotowany przez:</p>
                    <img src="twoje-logo.svg.svg" alt="Logo Firmy">
                </div>
            </div>

            <div class="screen" id="screen-section3">
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <h2>Sekcja III: Komunikacja i Budowanie Popytu</h2>
                <!-- Q7 dla Marki Firmy -->
                <div class="question-block" data-segment="company">
                    <p><strong>7. Nasz głos i styl wizualny (Tone of Voice & Style) są tak wyraziste, że klienci rozpoznaliby naszą komunikację, nawet gdyby usunąć z niej logo.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q7-1" name="q7" value="1"><label for="q7-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q7-2" name="q7" value="2"><label for="q7-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q7-3" name="q7" value="3"><label for="q7-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q7-4" name="q7" value="4"><label for="q7-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q7-5" name="q7" value="5"><label for="q7-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <!-- Q7 dla Marki Osobistej -->
                <div class="question-block" data-segment="personal">
                    <p><strong>7. Mój głos i styl wizualny (Tone of Voice & Style) są tak wyraziste, że klienci rozpoznaliby moją komunikację, nawet gdyby usunąć z niej logo.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q7p-1" name="q7" value="1"><label for="q7p-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q7p-2" name="q7" value="2"><label for="q7p-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q7p-3" name="q7" value="3"><label for="q7p-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q7p-4" name="q7" value="4"><label for="q7p-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q7p-5" name="q7" value="5"><label for="q7p-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <!-- Q8 dla Marki Firmy -->
                <div class="question-block" data-segment="company">
                    <p><strong>8. Nasze treści (artykuły, wideo, case studies) są tak wartościowe, że regularnie generują konkretne zapytania od idealnych, wstępnie przekonanych klientów.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q8-1" name="q8" value="1"><label for="q8-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q8-2" name="q8" value="2"><label for="q8-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q8-3" name="q8" value="3"><label for="q8-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q8-4" name="q8" value="4"><label for="q8-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q8-5" name="q8" value="5"><label for="q8-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <!-- Q8 dla Marki Osobistej -->
                <div class="question-block" data-segment="personal">
                    <p><strong>8. Moje treści (artykuły, wideo, case studies) są tak wartościowe, że regularnie generują konkretne zapytania od idealnych, wstępnie przekonanych klientów.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q8p-1" name="q8" value="1"><label for="q8p-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q8p-2" name="q8" value="2"><label for="q8p-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q8p-3" name="q8" value="3"><label for="q8p-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q8p-4" name="q8" value="4"><label for="q8p-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q8p-5" name="q8" value="5"><label for="q8p-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <!-- Q9 dla Marki Firmy -->
                <div class="question-block" data-segment="company">
                    <p><strong>9. Każdy pracownik mający kontakt z klientem potrafi opowiedzieć historię naszej marki w sposób, który jasno uzasadnia naszą wartość i cenę.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q9-1" name="q9" value="1"><label for="q9-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q9-2" name="q9" value="2"><label for="q9-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q9-3" name="q9" value="3"><label for="q9-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q9-4" name="q9" value="4"><label for="q9-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q9-5" name="q9" value="5"><label for="q9-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <!-- Q9 dla Marki Osobistej -->
                <div class="question-block" data-segment="personal">
                    <p><strong>9. W każdej interakcji – czy to w mediach społecznościowych, wystąpieniach czy rozmowach 1-on-1 – komunikuję moją unikalną wartość w sposób, który naturalnie przekłada się na zainteresowanie moją ofertą.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q9p-1" name="q9" value="1"><label for="q9p-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q9p-2" name="q9" value="2"><label for="q9p-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q9p-3" name="q9" value="3"><label for="q9p-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q9p-4" name="q9" value="4"><label for="q9p-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q9p-5" name="q9" value="5"><label for="q9p-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <h3 class="pytanie-lustro-tytul">Pytanie Lustro</h3>
                <!-- Mirror Q3 dla Marki Firmy -->
                <p data-segment="company">Gdybyś mógł zachować tylko jeden, jedyny element waszej komunikacji (jeden artykuł, film, case study), który najskuteczniej zamienia obcych ludzi w płacących klientów – co by to było i na czym polega jego siła?</p>
                <!-- Mirror Q3 dla Marki Osobistej -->
                <p data-segment="personal">Gdybyś mógł zachować tylko jeden, jedyny element twojej komunikacji (jeden post, artykuł, film, wystąpienie), który najskuteczniej przekonuje ludzi do współpracy z tobą – co by to było i na czym polega jego siła?</p>
                <textarea id="mirror-q3" placeholder="Twoja odpowiedź..."></textarea>
                <div class="form-navigation">
                    <button type="button" class="btn btn-prev">Wróć</button>
                    <button type="button" class="btn btn-primary btn-next">Dalej</button>
                </div>
                <div class="signature-footer">
                    <p>Audyt przygotowany przez:</p>
                    <img src="twoje-logo.svg.svg" alt="Logo Firmy">
                </div>
            </div>

            <div class="screen" id="screen-section4">
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <h2>Sekcja IV: Percepcja i Spójność Strategiczna</h2>
                <!-- Q10 dla Marki Firmy -->
                <div class="question-block" data-segment="company">
                    <p><strong>10. Nasz wizerunek (design, materiały, strona WWW) jest w pełni spójny z naszą strategią cenową i pozycjonowaniem, skutecznie komunikując zamierzoną wartość klientom.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q10-1" name="q10" value="1"><label for="q10-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q10-2" name="q10" value="2"><label for="q10-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q10-3" name="q10" value="3"><label for="q10-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q10-4" name="q10" value="4"><label for="q10-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q10-5" name="q10" value="5"><label for="q10-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <!-- Q10 dla Marki Osobistej -->
                <div class="question-block" data-segment="personal">
                    <p><strong>10. Mój wizerunek (design, materiały, strona WWW) jest w pełni spójny z moją strategią cenową i pozycjonowaniem, skutecznie komunikując zamierzoną wartość klientom.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q10p-1" name="q10" value="1"><label for="q10p-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q10p-2" name="q10" value="2"><label for="q10p-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q10p-3" name="q10" value="3"><label for="q10p-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q10p-4" name="q10" value="4"><label for="q10p-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q10p-5" name="q10" value="5"><label for="q10p-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <!-- Q11 dla Marki Firmy -->
                <div class="question-block" data-segment="company">
                    <p><strong>11. Każdy punkt styku klienta z naszą marką – od reklamy, przez proces sprzedaży, po obsługę – jest celowo zaprojektowany, aby wzmacniać naszą główną obietnicę rynkową.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q11-1" name="q11" value="1"><label for="q11-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q11-2" name="q11" value="2"><label for="q11-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q11-3" name="q11" value="3"><label for="q11-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q11-4" name="q11" value="4"><label for="q11-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q11-5" name="q11" value="5"><label for="q11-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <!-- Q11 dla Marki Osobistej -->
                <div class="question-block" data-segment="personal">
                    <p><strong>11. Każdy punkt styku klienta z moją marką – od reklamy, przez proces sprzedaży, po obsługę – jest celowo zaprojektowany, aby wzmacniać moją główną obietnicę rynkową.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q11p-1" name="q11" value="1"><label for="q11p-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q11p-2" name="q11" value="2"><label for="q11p-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q11p-3" name="q11" value="3"><label for="q11p-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q11p-4" name="q11" value="4"><label for="q11p-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q11p-5" name="q11" value="5"><label for="q11p-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <!-- Q12 dla Marki Firmy -->
                <div class="question-block" data-segment="company">
                    <p><strong>12. Nasza marka jest postrzegana jako lider lub unikalny specjalista w swojej kategorii, co pozwala nam unikać bezpośredniej konkurencji cenowej.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q12-1" name="q12" value="1"><label for="q12-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q12-2" name="q12" value="2"><label for="q12-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q12-3" name="q12" value="3"><label for="q12-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q12-4" name="q12" value="4"><label for="q12-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q12-5" name="q12" value="5"><label for="q12-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <!-- Q12 dla Marki Osobistej -->
                <div class="question-block" data-segment="personal">
                    <p><strong>12. Moja marka jest postrzegana jako lider lub unikalny specjalista w swojej kategorii, co pozwala mi unikać bezpośredniej konkurencji cenowej.</strong></p>
                    <div class="scale-container">
                        <div class="scale-item"><input type="radio" id="q12p-1" name="q12" value="1"><label for="q12p-1">1</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q12p-2" name="q12" value="2"><label for="q12p-2">2</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q12p-3" name="q12" value="3"><label for="q12p-3">3</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q12p-4" name="q12" value="4"><label for="q12p-4">4</label><span class="scale-description"></span></div>
                        <div class="scale-item"><input type="radio" id="q12p-5" name="q12" value="5"><label for="q12p-5">5</label><span class="scale-description"></span></div>
                    </div>
                </div>
                <h3 class="pytanie-lustro-tytul">Pytanie Lustro</h3>
                <!-- Mirror Q4 dla Marki Firmy -->
                <p data-segment="company">Jaka jest jedna, najważniejsza zmiana w postrzeganiu waszej marki, która pozwoliłaby wam podwoić marżę lub zdobyć klientów, którzy dziś są poza waszym zasięgiem?</p>
                <!-- Mirror Q4 dla Marki Osobistej -->
                <p data-segment="personal">Jaka jest jedna, najważniejsza zmiana w postrzeganiu ciebie jako eksperta, która pozwoliłaby ci podwoić stawki lub zdobyć klientów, którzy dziś są poza twoim zasięgiem?</p>
                <textarea id="mirror-q4" placeholder="Twoja odpowiedź..."></textarea>
                <div class="form-navigation">
                    <button type="button" class="btn btn-prev">Wróć</button>
                    <button type="button" id="calculate-btn" class="btn btn-primary">Zakończ i analizuj</button>
                </div>
                <div class="signature-footer">
                    <p>Audyt przygotowany przez:</p>
                    <img src="twoje-logo.svg.svg" alt="Logo Firmy">
                </div>
            </div>

            <!-- EKRAN WYNIKU PUNKTOWEGO -->
            <div class="screen" id="screen-score">
                <div class="start-logo">
                    <img src="twoje-logo.svg.svg" alt="Logo">
                </div>
                <h1 class="start-title">Audyt Kondycji Marki</h1>
                <h2 class="segment-question">Wynik marki <span id="brand-name-result"></span></h2>

                <div class="progress-ring-container">
                    <svg width="280" height="280" viewBox="0 0 280 280">
                        <defs>
                            <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" id="gradientStart" stop-color="#A8FF00" />
                                <stop offset="100%" id="gradientEnd" stop-color="#2C2C2C" />
                            </linearGradient>
                        </defs>
                        <!-- Background ring -->
                        <circle cx="140" cy="140" r="116" fill="none" stroke="#E8E8E8" stroke-width="24" />
                        <!-- Progress ring -->
                        <circle
                            id="progress-ring"
                            cx="140"
                            cy="140"
                            r="116"
                            fill="none"
                            stroke="url(#progressGradient)"
                            stroke-width="24"
                            stroke-linecap="round"
                            stroke-dasharray="728.5"
                            stroke-dashoffset="728.5"
                            transform="rotate(-90 140 140)"
                        />
                    </svg>
                    <div class="score-display">
                        <span class="score" id="score-value">0</span>
                        <span class="total">/60</span>
                    </div>
                </div>

                <h3 class="level-name" id="level-name">Obliczam wynik...</h3>
                <p class="level-description" id="level-description"></p>

                <button type="button" id="see-full-analysis-btn" class="btn btn-primary">ZOBACZ PEŁNĄ ANALIZĘ</button>

                <div class="score-footer">
                    <span>©Krystian Dąbrowski</span>
                    <span>www.krystiandabrowski.com</span>
                </div>
            </div>

            <div class="screen" id="screen-results">
                <!-- EKRAN 1: AI Analysis -->
                <div id="result-screen-1" class="result-screen" style="display: none;">
                    <!-- Header Image -->
                    <img id="analysis-header-image" src="Janawnioski.svg" alt="Analiza" class="analysis-header-image">

                    <!-- Tytuł z personalizacją -->
                    <h2 class="analysis-title">Cześć <span id="analysis-user-name"></span> tu Krystian</h2>

                    <!-- Intro -->
                    <p class="analysis-intro">Tak właściwie to mój Asystent Analytik AI, ale bez obaw, jest tak skonstruowany że korzysta tylko z dobrodziejstw mojej wiedzy i metod sprawdzonych w dziesiątkach projektów strategicznych.</p>

                    <!-- Podtytuł -->
                    <p class="analysis-subtitle">Na podstawie Twojego Audytu Kondycji Marki...</p>

                    <!-- Treść analizy -->
                    <div class="ai-analysis-content">
                        <div id="ai-loader-screen2">
                            <p>Przetwarzam analizę...</p>
                        </div>
                        <div id="ai-analysis-text" style="display: none;"></div>
                    </div>

                    <!-- Przyciski -->
                    <div class="analysis-buttons">
                        <button type="button" id="download-analysis-btn" class="btn btn-secondary-outline">POBIERZ PEŁNĄ ANALIZĘ</button>
                        <button type="button" id="go-to-cta-btn" class="btn btn-primary">SPRAWDŹ OFERTĘ</button>
                    </div>

                    <!-- Stopka -->
                    <div class="analysis-footer">
                        <p>©Krystian Dąbrowski | www.krystiandabrowski.com</p>
                    </div>
                </div>

                <!-- EKRAN 2: CTA Hub -->
                <div id="result-screen-2" class="result-screen" style="display: none;">
                    <h2 class="cta-hub-title">Gotowy na przełom?</h2>
                    <div class="cta-hub-container">
                        <a href="https://calendly.com/krystian-krystiandabrowski/30min" target="_blank" class="cta-hub-card">
                            <div class="cta-icon">🗓️</div>
                            <h3>Umów konsultację</h3>
                            <p>15 minut, darmowa rozmowa strategiczna</p>
                        </a>
                        <a href="https://www.figma.com/deck/S2Rr6ywbpVeFuv4JxvAzOy/Krystian-D%C4%85browski---Oferta?node-id=33-541&t=kr2DQPRcDIY7AbDL-1&scaling=min-zoom&content-scaling=fixed&page-id=0%3A1" target="_blank" class="cta-hub-card">
                            <div class="cta-icon">📋</div>
                            <h3>Zobacz ofertę</h3>
                            <p>Strategia & Branding dla ambitnych marek</p>
                        </a>
                        <a href="#newsletter" class="cta-hub-card" id="newsletter-cta">
                            <div class="cta-icon">💌</div>
                            <h3>Zapisz się na newsletter</h3>
                            <p>Tygodniowe insights o strategii marki</p>
                        </a>
                    </div>
                    <div class="social-footer">
                        <p>Znajdź mnie również na:</p>
                        <div class="social-links">
                            <a href="#" target="_blank">LinkedIn</a>
                            <a href="#" target="_blank">Instagram</a>
                            <a href="#" target="_blank">Twitter</a>
                        </div>
                    </div>
                </div>

                <!-- Gibberish handling -->
                <div id="next-steps-gibberish" style="display: none; text-align: center; margin-top: 30px;">
                    <h3>Prawdziwa diagnoza wymaga zaangażowania.</h3>
                    <p>To narzędzie zostało zaprojektowane, aby dostarczać realną wartość liderom, którzy są gotowi na szczerą autorefleksję.</p>
                    <p style="margin-top:15px;">Jeśli jesteś gotów podejść do audytu na poważnie, zacznij od nowa.</p>
                    <button type="button" id="restart-btn" class="btn btn-primary" style="margin-top: 20px;">Zacznij od nowa</button>
                </div>
            </div>
            </div>
        </form>
    </div>
    <script>
 
        const API_BASE_URL = 'http://localhost:3000';
        let originalAuditText = '';
        let finalScore, finalResultTitle, finalResultDesc, finalAiText;
        let userName = '', brandName = '';

        document.addEventListener('DOMContentLoaded', () => {
            const auditContainer = document.querySelector('.audit-container');
            const screens = document.querySelectorAll('.screen');
            const progressBars = document.querySelectorAll('.progress-fill');
            const downloadBtn = document.getElementById('download-btn');
            let currentScreenId = 'screen-segment';
            let userSegment = ''; // 'company' lub 'personal'

            // Mapa kolejności ekranów
            const screenOrder = [
                'screen-segment',
                'screen-personalization',
                'screen-section1',
                'screen-section2',
                'screen-section3',
                'screen-section4',
                'screen-score',
                'screen-results'
            ];

            // Funkcja zamiany ekranów
            const showScreen = (screenId) => {
                // Ukryj wszystkie ekrany
                screens.forEach(screen => screen.classList.remove('active'));

                // Pokaż wybrany ekran
                const targetScreen = document.getElementById(screenId);
                if (targetScreen) {
                    targetScreen.classList.add('active');
                    currentScreenId = screenId;
                }

                // Zaktualizuj UI
                updateProgressBar();
                updateContainerClasses();

                // Scroll do góry
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            // Funkcja aktualizacji progress bara
            const updateProgressBar = () => {
                const currentIndex = screenOrder.indexOf(currentScreenId);
                // Ekrany pytań to indeksy 2-5 (4 sekcje)
                if (currentIndex >= 2 && currentIndex <= 5) {
                    const questionProgress = ((currentIndex - 2) / 4) * 100;
                    // Aktualizuj wszystkie progress bary
                    progressBars.forEach(bar => {
                        bar.style.width = `${questionProgress}%`;
                    });
                }
                // Dla screen-score i screen-results progress bar jest ukryty
            };

            // Funkcja aktualizacji klas kontenera
            const updateContainerClasses = () => {
                auditContainer.classList.remove('on-first-step', 'on-results-step');
                const currentIndex = screenOrder.indexOf(currentScreenId);
                if (currentIndex <= 1) {
                    auditContainer.classList.add('on-first-step');
                } else if (currentScreenId === 'screen-score' || currentScreenId === 'screen-results') {
                    auditContainer.classList.add('on-results-step');
                }
            };

            // Obsługa wyboru segmentu
            document.querySelectorAll('.segment-card').forEach(card => {
                card.addEventListener('click', function(e) {
                    console.log('Segment card clicked!', this.dataset.segment);
                    e.stopPropagation();
                    document.querySelectorAll('.segment-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    userSegment = this.dataset.segment;
                    const nextBtn = document.getElementById('segment-next-btn');
                    nextBtn.disabled = false;
                    nextBtn.style.opacity = '1';

                    // Aktualizuj label dla brand name
                    const brandLabel = document.getElementById('brand-name-label');
                    const brandInput = document.getElementById('brand-name');
                    if (userSegment === 'personal') {
                        brandLabel.innerHTML = 'Nazwa Twojej marki osobistej <span style="color: var(--text-muted); font-weight: 400;">(opcjonalne)</span>:';
                        brandInput.placeholder = 'np. Anna Kowalska Coaching';
                    } else {
                        brandLabel.textContent = 'Nazwa Twojej marki/firmy:';
                        brandInput.placeholder = 'np. ABC Marketing';
                    }

                    // Aktualizuj widoczność pytań
                    updateQuestionVisibility();
                });
            });

            // Funkcja ukrywająca/pokazująca pytania w zależności od segmentu
            const updateQuestionVisibility = () => {
                document.querySelectorAll('[data-segment]:not(.segment-card)').forEach(el => {
                    if (el.dataset.segment === userSegment) {
                        el.style.display = '';
                    } else {
                        el.style.display = 'none';
                    }
                });
                // Zawsze pokazuj obie karty segmentów
                document.querySelectorAll('.segment-card').forEach(card => {
                    card.style.display = '';
                });
            };

            const scaleLabelsLong = ["Zdecydowanie nie", "Raczej nie", "Trudno powiedzieć", "Raczej tak", "Zdecydowanie tak"];
            const scaleLabelsShort = ["Wcale", "Rzadko", "Czasami", "Często", "Zawsze"];
 
            const updateScaleDescriptions = () => {
                const allDescriptions = document.querySelectorAll('.scale-description');
                const labels = window.innerWidth <= 768 ? scaleLabelsShort : scaleLabelsLong;
                allDescriptions.forEach((span, index) => {
                    span.textContent = labels[index % 5];
                });
            };
 
            // Funkcja walidacji ekranu
            const validateScreen = (screenId) => {
                if (screenId === 'screen-segment') {
                    // Walidacja wyboru segmentu
                    if (!userSegment) {
                        alert('Proszę wybrać segment - Marka Firmy lub Marka Osobista.');
                        return false;
                    }
                    return true;
                } else if (screenId === 'screen-personalization') {
                    // Walidacja personalizacji - imię i nazwa marki
                    const userNameInput = document.getElementById('user-name');
                    const brandNameInput = document.getElementById('brand-name');

                    userNameInput.style.borderColor = 'var(--border-color)';
                    brandNameInput.style.borderColor = 'var(--border-color)';

                    let isValid = true;

                    if (userNameInput.value.trim().length === 0) {
                        userNameInput.style.borderColor = 'red';
                        isValid = false;
                    }

                    // Dla Marki Firmy wymagana jest nazwa marki, dla Marki Osobistej - opcjonalna
                    if (userSegment === 'company' && brandNameInput.value.trim().length === 0) {
                        brandNameInput.style.borderColor = 'red';
                        isValid = false;
                    }

                    if (!isValid) {
                        alert('Proszę wypełnić wszystkie wymagane pola, aby przejść dalej.');
                        return false;
                    }

                    // Zapisz dane
                    userName = userNameInput.value.trim();
                    brandName = brandNameInput.value.trim();
                    return true;
                } else if (screenId.startsWith('screen-section')) {
                    // Walidacja sekcji pytań
                    const screen = document.getElementById(screenId);
                    let allAnswered = true;
                    const questions = screen.querySelectorAll('.question-block:not([style*="display: none"])');
                    questions.forEach(q => {
                        q.style.borderColor = 'transparent';
                        if (!q.querySelector('input[type="radio"]:checked')) {
                            q.style.borderColor = 'red';
                            allAnswered = false;
                        }
                    });

                    const textarea = screen.querySelector('textarea');
                    if (textarea) {
                        textarea.style.borderColor = 'var(--border-color)';
                        if (textarea.value.trim().length === 0) {
                            textarea.style.borderColor = 'red';
                            allAnswered = false;
                        }
                    }

                    if (!allAnswered) {
                        alert('Proszę odpowiedzieć na wszystkie pytania w tej sekcji, aby przejść dalej.');
                    }
                    return allAnswered;
                }
                return true;
            };
 
            // Obsługa nawigacji
            document.addEventListener('click', e => {
                if (e.target.matches('.btn-next')) {
                    // Przycisk "Dalej"
                    if (validateScreen(currentScreenId)) {
                        const currentIndex = screenOrder.indexOf(currentScreenId);
                        if (currentIndex < screenOrder.length - 1) {
                            showScreen(screenOrder[currentIndex + 1]);
                        }
                    }
                } else if (e.target.matches('#calculate-btn')) {
                    // Przycisk "Zakończ i analizuj"
                    if (validateScreen(currentScreenId)) {
                        handleCalculation();
                        showScreen('screen-score');
                        // Animuj wynik po pokazaniu ekranu
                        setTimeout(() => {
                            animateScoreScreen();
                        }, 300);
                    }
                } else if (e.target.matches('#see-full-analysis-btn')) {
                    // Przycisk "Zobacz pełną analizę"
                    showScreen('screen-results');
                    handleResultsScreen();
                } else if (e.target.matches('.btn-prev')) {
                    // Przycisk "Wróć"
                    const currentIndex = screenOrder.indexOf(currentScreenId);
                    if (currentIndex > 0) {
                        showScreen(screenOrder[currentIndex - 1]);
                    }
                }
            });
 
            const animateValue = (obj, start, end, duration) => {
                let startTimestamp = null;
                const step = (timestamp) => {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    obj.innerHTML = Math.floor(progress * (end - start) + start);
                    if (progress < 1) window.requestAnimationFrame(step);
                };
                window.requestAnimationFrame(step);
            };

            // === NEW: 3-SCREEN FLOW FUNCTIONS ===

            // Function to switch between result screens
            const showResultScreen = (screenNumber) => {
                document.querySelectorAll('.result-screen').forEach(screen => {
                    screen.style.display = 'none';
                    screen.classList.remove('active');
                });
                const targetScreen = document.getElementById(`result-screen-${screenNumber}`);
                if (targetScreen) {
                    targetScreen.style.display = 'block';
                    setTimeout(() => targetScreen.classList.add('active'), 50);
                }
            };


            const calculateTotalScore = () => {
                let totalScore = 0;
                const allCheckedRadios = document.querySelectorAll('#audit-form input[type="radio"]:checked');
                allCheckedRadios.forEach(radio => {
                    totalScore += parseInt(radio.value, 10);
                });
                return totalScore;
            };

            // Funkcja animacji ekranu wyniku punktowego
            const animateScoreScreen = () => {
                const score = calculateTotalScore();
                const percentage = (score / 60) * 100;

                // Ustaw personalizację nazwy marki
                const brandNameResult = document.getElementById('brand-name-result');
                if (brandName && brandName.trim() !== '') {
                    brandNameResult.textContent = brandName;
                } else if (userName && userName.trim() !== '') {
                    brandNameResult.textContent = userName;
                } else {
                    brandNameResult.textContent = '';
                }

                // Oblicz długość obwodu koła (2 * π * r), gdzie r = 116
                const radius = 116;
                const circumference = 2 * Math.PI * radius; // ~728.5
                const progressRing = document.getElementById('progress-ring');

                // Ustaw początkową wartość
                progressRing.style.strokeDasharray = circumference;
                progressRing.style.strokeDashoffset = circumference;

                // Ustaw gradient wg wyniku
                const gradientStart = document.getElementById('gradientStart');
                const gradientEnd = document.getElementById('gradientEnd');

                if (score <= 15) {
                    gradientStart.setAttribute('stop-color', '#FF4444');
                    gradientEnd.setAttribute('stop-color', '#FF8800');
                } else if (score <= 25) {
                    gradientStart.setAttribute('stop-color', '#FF8800');
                    gradientEnd.setAttribute('stop-color', '#FFB800');
                } else if (score <= 35) {
                    gradientStart.setAttribute('stop-color', '#FFB800');
                    gradientEnd.setAttribute('stop-color', '#FFE600');
                } else if (score <= 45) {
                    gradientStart.setAttribute('stop-color', '#FFE600');
                    gradientEnd.setAttribute('stop-color', '#C8FF00');
                } else if (score <= 54) {
                    gradientStart.setAttribute('stop-color', '#C8FF00');
                    gradientEnd.setAttribute('stop-color', '#A8FF00');
                } else {
                    gradientStart.setAttribute('stop-color', '#A8FF00');
                    gradientEnd.setAttribute('stop-color', '#80FF00');
                }

                // Animuj progress ring
                setTimeout(() => {
                    const offset = circumference - (percentage / 100) * circumference;
                    progressRing.style.strokeDashoffset = offset;
                }, 100);

                // Animuj wartość wyniku
                const scoreValue = document.getElementById('score-value');
                animateValue(scoreValue, 0, score, 2000);

                // Ustaw poziom i opis
                const levelName = document.getElementById('level-name');
                const levelDescription = document.getElementById('level-description');

                if (score <= 15) {
                    levelName.textContent = 'Fundamenty wymagają budowy';
                    levelDescription.textContent = 'Twoja marka działa w trybie przetrwania. Brakuje fundamentów strategicznych, przez co każda decyzja marketingowa jest chaotyczna i intuicyjna. To poziom, na którym nie budujesz marki – tylko reagujesz na sytuację. Czas na zmianę podejścia i zbudowanie solidnych podstaw, które pozwolą Ci działać strategicznie.';
                } else if (score <= 25) {
                    levelName.textContent = 'Pora na strategiczne podstawy';
                    levelDescription.textContent = 'Masz pojedyncze elementy brandingu, ale brakuje im spójnej strategii. Twoja marka nie ma jasnej tożsamości, co sprawia, że komunikacja jest niespójna, a działania marketingowe nie przynoszą zakładanych efektów. Potrzebujesz uporządkować podstawy i stworzyć fundament, na którym zbudujesz silną pozycję.';
                } else if (score <= 35) {
                    levelName.textContent = 'Dobra baza, brakuje spójności';
                    levelDescription.textContent = 'Masz solidne podstawy, ale Twoja marka działa w zrywach. Poszczególne elementy są na miejscu, ale brakuje im systemowego połączenia i konsekwentnej realizacji. Potrzebujesz uporządkować to, co masz, wprowadzić spójność i zacząć działać bardziej strategicznie. Jest potencjał – czas go wykorzystać.';
                } else if (score <= 45) {
                    levelName.textContent = 'Silna pozycja, potencjał wzrostu';
                    levelDescription.textContent = 'Twoja marka jest w dobrej formie i zaczyna pracować na Twoją korzyść. Masz jasną tożsamość i spójną komunikację, ale wciąż jest przestrzeń do optymalizacji. Z odpowiednimi udoskonaleniami możesz przejść na wyższy poziom i zdominować swoją kategorię.';
                } else if (score <= 54) {
                    levelName.textContent = 'Strategiczny lider';
                    levelDescription.textContent = 'Twoja marka działa jak dobrze naoliwiona maszyna strategiczna. Masz jasną pozycję, spójną komunikację i świadomość swojej wartości. Koncentruj się na maksymalizacji efektów, skalowaniu działań i utrzymaniu konsekwencji. Jesteś w czołówce swojej branży – teraz chodzi o to, żeby tam pozostać i poszerzać przewagę.';
                } else {
                    levelName.textContent = 'Mistrzostwo strategiczne';
                    levelDescription.textContent = 'Twoja marka jest w elitarnym gronie marek, które nie konkurują – one kreują kategorie i dyktują warunki rynkowi. Działasz w pełni strategicznie, Twoja komunikacja jest spójna na każdym poziomie, a wartość marki jest klarownie zdefiniowana i wykorzystywana. To poziom najwyższej dojrzałości brandingowej.';
                }
            };

            // NOWA WERSJA FILTRA - działa teraz też w frontendzie
            const isInputGibberish = (answers) => {
                let totalLength = 0;
                let validAnswers = 0;
                let suspiciousAnswers = 0;

                for (const answer of answers) {
                    const lowerCaseAnswer = answer.toLowerCase().trim();
                    if (lowerCaseAnswer.length === 0) {
                        suspiciousAnswers++;
                        continue;
                    }

                    totalLength += lowerCaseAnswer.length;

                    // Sprawdź TYLKO krótkie, bezsensowne odpowiedzi (< 15 znaków)
                    if (lowerCaseAnswer.length < 15) {
                        const veryShortBadWords = ['nie wiem', 'trudno powiedzieć', 'test', 'asdf', 'brak', 'xd', 'ok', 'asd', 'qwe', 'zxc', 'brak pomysłu'];
                        if (veryShortBadWords.some(word => lowerCaseAnswer === word || lowerCaseAnswer === word + '.')) {
                            suspiciousAnswers++;
                            continue;
                        }
                    }

                    // Sprawdź powtarzające się znaki (np. "aaaaa", "asdasdasd")
                    if (/^(.{1,3})\1{2,}$/.test(lowerCaseAnswer)) {
                        suspiciousAnswers++;
                        continue;
                    }

                    // Sprawdź same cyfry
                    if (/^\d+$/.test(lowerCaseAnswer)) {
                        suspiciousAnswers++;
                        continue;
                    }

                    // Sprawdź losowe ciągi znaków - mniej niż 15% samogłosek i minimum 5 spółgłosek z rzędu
                    const vowels = (lowerCaseAnswer.match(/[aąeęioóuy]/g) || []).length;
                    const consonants = (lowerCaseAnswer.match(/[bcćdfghjklłmnńprsśtwzźż]/g) || []).length;
                    const hasConsecutiveConsonants = /[bcćdfghjklłmnńprsśtwzźż]{5,}/.test(lowerCaseAnswer);

                    if (consonants > 0 && vowels / (vowels + consonants) < 0.15 && hasConsecutiveConsonants) {
                        suspiciousAnswers++;
                        continue;
                    }

                    // Jeśli odpowiedź ma sensowną długość (>= 20 znaków), traktuj jako OK
                    if (lowerCaseAnswer.length >= 20) {
                        validAnswers++;
                    } else if (lowerCaseAnswer.length >= 10) {
                        // Średnie odpowiedzi - liczymy jako 0.5
                        validAnswers += 0.5;
                    }
                }

                // KRYTERIA ODRZUCENIA - muszą być spełnione WSZYSTKIE:
                // 1. Łączna długość wszystkich odpowiedzi < 50 znaków
                if (totalLength < 50) return true;

                // 2. Więcej niż 2 podejrzane odpowiedzi
                if (suspiciousAnswers > 2) return true;

                // 3. Mniej niż 2 sensowne odpowiedzi
                if (validAnswers < 2) return true;

                return false;
            };
 
            // ZASTĄP STARĄ WERSJĘ FUNKCJI TĄ PONIŻEJ:
            const handleCalculation = () => {
                finalScore = calculateTotalScore();
                // Wynik jest już obliczony i będzie użyty w screen-score
            };

            // NOWA WERSJA handleResultsScreen - obsługuje AI analysis
            const handleResultsScreen = () => {
                const answers = [
                    document.getElementById('mirror-q1').value,
                    document.getElementById('mirror-q2').value,
                    document.getElementById('mirror-q3').value,
                    document.getElementById('mirror-q4').value
                ];

                // Sprawdź czy odpowiedzi są sensowne
                if (isInputGibberish(answers)) {
                    document.getElementById('next-steps-gibberish').style.display = 'block';
                    return;
                }

                // Pokaż ekran AI analysis
                showResultScreen(1);

                // Ustaw personalizację - imię użytkownika w tytule
                const analysisUserName = document.getElementById('analysis-user-name');
                if (analysisUserName) {
                    if (userName && userName.trim() !== '') {
                        analysisUserName.textContent = userName;
                    } else if (brandName && brandName.trim() !== '') {
                        analysisUserName.textContent = brandName;
                    } else {
                        analysisUserName.textContent = '';
                    }
                }

                // Zmień obrazek na Radical Clarity.svg podczas ładowania
                const headerImage = document.getElementById('analysis-header-image');
                if (headerImage) {
                    headerImage.src = 'Radical Clarity.svg';
                }

                // Pokaż loader AI
                const aiLoader = document.getElementById('ai-loader-screen2');
                if (aiLoader) aiLoader.style.display = 'block';

                const aiTextElement = document.getElementById('ai-analysis-text');
                if (aiTextElement) aiTextElement.style.display = 'none';

                // Wywołaj API AI
                fetch(`${API_BASE_URL}/api/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        score: finalScore,
                        answers: answers,
                        userName: userName,
                        brandName: brandName,
                        userSegment: userSegment
                    }),
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Błąd serwera.');
                    }
                    return response.json();
                })
                .then(data => {
                    finalAiText = data.analysis;
                    aiTextElement.innerText = finalAiText;
                })
                .catch(error => {
                    console.error('Błąd:', error);
                    finalAiText = 'Wystąpił błąd podczas łączenia z serwerem analizy. Spróbuj ponownie później.';
                    aiTextElement.innerText = finalAiText;
                })
                .finally(() => {
                    // Zmień obrazek z powrotem na Janawnioski.svg
                    if (headerImage) {
                        headerImage.src = 'Janawnioski.svg';
                    }

                    // Ukryj loader, pokaż tekst
                    if (aiLoader) aiLoader.style.display = 'none';
                    if (aiTextElement) aiTextElement.style.display = 'block';
                });
            };

            // === EVENT LISTENERS ===

            // Restart button
            const restartBtn = document.getElementById('restart-btn');
            if (restartBtn) {
                restartBtn.addEventListener('click', () => {
                    location.reload();
                });
            }

            // Go to CTA hub button
            const goToCtaBtn = document.getElementById('go-to-cta-btn');
            if (goToCtaBtn) {
                goToCtaBtn.addEventListener('click', () => {
                    showResultScreen(2);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }

            // Download analysis button
            const downloadAnalysisBtn = document.getElementById('download-analysis-btn');
            if (downloadAnalysisBtn) {
                downloadAnalysisBtn.addEventListener('click', () => {
                    if (!finalAiText || finalAiText.trim() === '') {
                        alert('Analiza nie jest jeszcze gotowa. Proszę czekać...');
                        return;
                    }

                    // Utwórz pełny tekst do pobrania
                    const fullText = `Audyt Kondycji Marki - Analiza

Wynik: ${finalScore}/60 punktów
${userName ? 'Imię: ' + userName : ''}
${brandName ? 'Marka: ' + brandName : ''}
${userSegment ? 'Segment: ' + userSegment : ''}

=== ANALIZA ===

${finalAiText}

---
©Krystian Dąbrowski
www.krystiandabrowski.com`;

                    // Pobierz jako plik tekstowy
                    const blob = new Blob([fullText], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `Analiza_Marki_${brandName || userName || 'Raport'}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                });
            }

            // === USUNIĘTE: Stare funkcje i event listenery ===
            // - drawShareableGraphic() - usunięte
            // - download-graphic-btn - usunięty
            // - go-to-analysis-btn - usunięty
            // - pre-results-loader logic - usunięty

            // Inicjalizuj UI przy starcie
            updateContainerClasses();
            updateScaleDescriptions();
            window.addEventListener('resize', updateScaleDescriptions);
        });

    </script>
</body>
</html>
